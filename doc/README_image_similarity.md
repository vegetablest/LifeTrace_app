# 文本与图像相似度计算程序

## 概述

这是一个基于CLIP多模态模型的文本与图像相似度计算程序，可以输入任意文本，返回与数据库中所有图像的相似度分数。该程序已完全集成到LifeTrace系统中，提供Web API和命令行两种使用方式，专门用于语义搜索和图像检索?
## 功能特点

- 🔍 **多模态语义搜?*：基于CLIP模型理解文本和图像的语义关系
- 📊 **相似度计?*：使用改进的相似度公式处理各种距离?- 📋 **详细信息展示**：显示图像路径、OCR文本、应用程序、窗口标题等
- ?**高性能**：平均查询时间约0.03?- 🎯 **灵活控制**：支持限制返回数量和详细信息显示

## 程序文件

### 1. `text_to_image_similarity.py`
**命令行版?*，适合脚本调用和批处理

```bash
# 基本用法
python text_to_image_similarity.py "电脑"

# 限制结果数量
python text_to_image_similarity.py "网页" --limit 5

# 显示详细信息
python text_to_image_similarity.py "浏览? --details

# 详细日志
python text_to_image_similarity.py "文档" --verbose
```

### 2. `interactive_image_similarity.py`
**交互式版?*，提供友好的用户界面

```bash
python interactive_image_similarity.py
```

支持的交互命令：
- 直接输入文本进行搜索
- `help` - 显示帮助信息
- `stats` - 显示系统统计
- `quit` - 退出程?
### 3. Web API方式（推荐）
**通过LifeTrace Web服务使用**

```bash
# 启动LifeTrace服务
python -m lifetrace_backend.server --port 8843

# 使用多模态搜索API
curl -X POST http://localhost:8843/api/multimodal-search \
  -H "Content-Type: application/json" \
  -d '{"query": "电脑", "top_k": 10, "text_weight": 0.6, "image_weight": 0.4}'
```

### 4. `demo_image_similarity.py`
**演示脚本**，展示程序的各种功能

```bash
python demo_image_similarity.py
```

演示内容包括?- 数据库统计信?- 基本搜索功能
- 相似度分?- 应用程序分析
- 文本内容分析
- 性能测试

## 安装和配?
### 前提条件

1. **LifeTrace系统**：需要已安装并运行LifeTrace系统
2. **多模态功?*：需要启用多模态向量服?3. **数据准备**：需要数据库中有截图和OCR数据

### 依赖检?
确保以下组件正常工作?- 多模态向量服务已启用
- CLIP模型已下?- 图像向量数据库有数据
- 关系数据库连接正?
## 使用示例

### 命令行版本示?
```bash
# 搜索?电脑"相关的图?python text_to_image_similarity.py "电脑" --limit 3 --details
```

输出示例?```
查询文本: 电脑

找到 3 个相关图?

--------------------------------------------------------------------------------
  1. OCR ID: 1
     相似? 0.3993 (距离: 1.5042)
     图像路径: C:\Users\PC\.lifetrace\screenshots\Snipaste_2025-08-19_21-37-15.jpg
     文本内容: ?36.4?00:40 【独家?《灵笼第二季》第12集预??月国创?     
     应用程序: Snipaste
     窗口标题: Snipaste截图 - Snipaste_2025-08-19_21-37-15.jpg
     创建时间: 2025-08-19T14:10:54
     置信? 0.8
     语言: ch
--------------------------------------------------------------------------------
```

### 交互式版本示?
```
============================================================
🔍 LifeTrace 交互式图像相似度搜索
============================================================
功能说明:
?输入任意文本，搜索相似的图像
?支持中英文查??基于CLIP多模态模型的语义搜索

可用命令:
?help/h/?     - 显示帮助信息
?stats/status - 显示系统统计
?quit/exit/q  - 退出程?============================================================

请输入查询文?(输入 'quit' ?'exit' 退?: 电脑

🔍 搜索: 电脑
--------------------------------------------------
显示多少个结果？(默认5个，按回车使用默认?: 3

📊 找到 3 个相关图?

 1. 📷 OCR ID: 1
    相似? 0.3993 🟠 ?    应用: Snipaste
    窗口: Snipaste截图 - Snipaste_2025-08-19_21-37-15.jpg
    文本: ?36.4?00:40 【独家?《灵笼第二季》第12集预??月国创?..
    路径: Snipaste_2025-08-19_21-37-15.jpg
```

## 相似度等?
程序使用颜色编码表示相似度等级：

- 🟢 **?* (?.7) - 非常相关
- 🟡 **?* (?.5) - 比较相关  
- 🟠 **?* (?.3) - 有些相关
- 🔴 **很低** (<0.3) - 相关性较?
## 性能指标

根据演示测试结果?
- **平均查询时间**?.028?- **平均结果?*??查询
- **支持数据?*：当前测试数据库包含4个图?- **内存使用**：模型加载后约占?00MB内存

## 技术实?
### 核心技?
1. **CLIP模型**：OpenAI的多模态预训练模型
2. **向量搜索**：基于Chroma向量数据?3. **相似度计?*：使用公?`1.0 / (1.0 + distance)`
4. **数据增强**：结合关系数据库的元数据

### 架构设计

```
文本输入 ?CLIP文本编码??文本向量
                                ?图像数据??向量搜索 ?相似度计?    ?结果增强 ?关系数据库查??OCR/截图元数?    ?格式化输?```

## 故障排除

### 常见问题

1. **"多模态向量服务未启用"**
   - 检查LifeTrace配置文件
   - 确保多模态功能已启用

2. **"图像向量数据库中没有数据"**
   - 运行LifeTrace系统收集截图
   - 检查向量数据库同步状?
3. **"无法生成查询文本的嵌?**
   - 检查CLIP模型下载状?   - 确保网络连接正常

### 调试方法

```bash
# 使用详细日志
python text_to_image_similarity.py "测试" --verbose

# 检查系统状?python interactive_image_similarity.py
# 然后输入 "stats" 命令
```

## 扩展功能

### 可能的改?
1. **批量处理**：支持批量查询文?2. **结果导出**：导出为JSON/CSV格式
3. **图像预览**：在终端显示图像缩略?4. **高级过滤**：按时间、应用程序等过滤
5. **缓存机制**：缓存常用查询结?
### 集成建议

1. **Web API**：包装为REST API服务
2. **GUI界面**：开发图形用户界?3. **插件系统**：集成到其他应用程序
4. **实时搜索**：支持实时搜索建?
## 许可?
本程序遵循LifeTrace项目的许可证条款?
## 贡献

欢迎提交问题报告和功能请求。在贡献代码前，请确保：

1. 代码符合项目规范
2. 添加适当的测?3. 更新相关文档
4. 通过所有测试用?
## 联系方式

如有问题或建议，请通过LifeTrace项目的官方渠道联系
