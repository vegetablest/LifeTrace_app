<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小鲁AI</title>
    <!-- External Libraries -->
    <script src="./lib/marked.min.js"></script>
    <script src="./lib/lucide.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>


    <!-- Main Chat Area -->
    <main class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <!-- Welcome Screen -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-content">
                    <h1 class="welcome-title">我可以帮您做什么？</h1>
                    <div class="quick-actions">
                        <button class="btn btn-outline" onclick="insertQuickQuery('查询今天的截图记录')">
                            <i data-lucide="plus"></i>
                            查询截图记录
                        </button>
                        <button class="btn btn-outline" onclick="insertQuickQuery('分析我的应用使用情况')">
                            <i data-lucide="brain"></i>
                            应用分析
                        </button>
                        <button class="btn btn-outline" onclick="insertQuickQuery('搜索包含特定内容的截图')">
                            <i data-lucide="search"></i>
                            内容搜索
                        </button>
                    </div>
                </div>
            </div>

            <!-- Messages List -->
            <div class="messages-list" id="messagesList" style="display: none;">
                <!-- 消息将在这里动态添加 -->
            </div>
        </div>

        <div class="thinking-indicator" id="thinkingIndicator" style="display: none;">
            <div class="thinking-avatar">
                <i data-lucide="bot"></i>
            </div>
            <div class="thinking-content">
                <div class="thinking-text" id="thinkingText">正在思考</div>
                <div class="thinking-dots">
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                    <div class="thinking-dot"></div>
                </div>
            </div>
        </div>

        <!-- 保持原有的loading指示器以兼容性 -->
        <div class="loading" id="loadingIndicator">
            <div class="message-avatar" style="background: var(--accent); color: var(--accent-foreground);">
                <i data-lucide="bot"></i>
            </div>
            <span>正在思考<span class="loading-dots"></span></span>
        </div>

        <!-- Input Area -->
        <div class="chat-input-container">
            <div class="input-wrapper">
                <form class="chat-input-form" id="chatForm">
                    <div class="input-container">
                        <textarea
                            class="chat-input"
                            id="chatInput"
                            placeholder="询问 LifeTrace 助手..."
                            rows="1"
                            required
                        ></textarea>
                        <button type="submit" class="send-button" id="sendButton">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"></path>
                                <path d="m21.854 2.147-10.94 10.939"></path>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>设置</h3>
                <span class="close" onclick="closeSettingsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="localHistoryEnabled" checked>
                        启用本地历史记录
                    </label>
                    <p class="setting-description">保存对话历史到本地存储</p>
                </div>

                <div class="setting-group">
                    <label for="historyLimit">历史记录条数限制:</label>
                    <input type="number" id="historyLimit" value="6" min="1" max="20">
                    <p class="setting-description">每次对话携带的历史记录条数</p>
                </div>

                <div class="setting-group">
                    <label for="serverUrl">服务器地址:</label>
                    <input type="text" id="serverUrl" value="http://127.0.0.1:8840" placeholder="http://127.0.0.1:8840">
                    <p class="setting-description">LifeTrace 后端服务器地址</p>
                </div>

                <div class="setting-group">
                    <button class="btn btn-outline" onclick="clearAllHistory()">清除所有历史记录</button>
                    <p class="setting-description">删除所有本地保存的对话记录</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveSettings()">保存设置</button>
                <button class="btn btn-outline" onclick="closeSettingsModal()">取消</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
